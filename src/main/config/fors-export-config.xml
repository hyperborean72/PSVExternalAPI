<?xml version="1.0" encoding="UTF-8"?>

<beans
    xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd">

  <bean id="forsExporter" class="ru.csbi.transport.psv.externalapi.fors.ForsExporter">
    <property name="exportPath" value="${fors.exportPath}"/>
    <property name="fileNameTemplate" value="${fors.fileNameTemplate}"/>
    <property name="ftpServer" value="${fors.ftp.server}"/>
    <property name="ftpUsername" value="${fors.ftp.username}"/>
    <property name="ftpPassword" value="${fors.ftp.password}"/>
    <property name="ftpExportDir" value="${fors.ftp.exportDir}"/>
    <property name="ftpPort" value="${fors.ftp.port}"/>
    <property name="checkFileNameTemplate" value="${fors.checkFileNameTemplate}"/>
    <property name="operationDayFactory" ref="operationDayFactory"/>
  </bean>

  <bean id="forsExportVisitor" class="ru.csbi.transport.psv.externalapi.fors.ForsVisitorImpl"  scope="prototype">
  </bean>

  <bean id="forsExportJob" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
    <property name="targetObject" ref="forsExporter"/>
    <property name="targetMethod" value="doExport"/>
    <property name="concurrent" value="false"/>
    <property name="group" value="forsExport"/>
  </bean>

  <!-- Одноразовый экспорт при старте приложения -->
  <bean id="forsStartExportTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
    <property name="jobDetail" ref="forsExportJob"/>
    <property name="repeatCount" value="0"/>
  </bean>

  <!-- Автоматический экспорт по расписанию (в 3 часа ночи) -->
  <bean id="forsExportTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="forsExportJob"/>
    <property name="cronExpression" value="${fors.cronExpression}"/>
  </bean>

</beans>