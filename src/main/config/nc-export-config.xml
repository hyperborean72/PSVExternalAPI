<?xml version="1.0" encoding="UTF-8"?>

<beans
    xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd">

  <bean id="ncExportVisitor" class="ru.csbi.transport.psv.externalapi.ncexport.NCExportVisitorImpl" scope="prototype"/>

  <bean id="ncExporter" class="ru.csbi.transport.psv.externalapi.ncexport.NCFileExporter">
    <property name="exportPath" value="${nc.exportPath}"/>
    <property name="fileNameTemplate" value="${nc.fileNameTemplate}"/>
    <property name="ftpServer" value="${nc.ftp.server}"/>
    <property name="ftpUsername" value="${nc.ftp.username}"/>
    <property name="ftpPassword" value="${nc.ftp.password}"/>
    <property name="ftpImportDir" value="${nc.ftp.importDir}"/>
    <property name="ftpResultDir" value="${nc.ftp.resultDir}"/>
  </bean>

  <bean id="ncExportJob" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
    <property name="targetObject" ref="ncExporter"/>
    <property name="targetMethod" value="doExport"/>
    <property name="concurrent" value="false"/>
    <property name="group" value="ncExport"/>
  </bean>

  <!-- Одноразовый экспорт при старте приложения -->
  <bean id="ncStartExportTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
    <property name="jobDetail" ref="ncExportJob"/>
    <property name="repeatCount" value="0"/>
  </bean>

  <!-- Автоматический экспорт по расписанию (в 3 часа ночи) -->
  <bean id="ncExportTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="ncExportJob"/>
    <property name="cronExpression" value="${nc.cronExpression}"/>
  </bean>

</beans>
